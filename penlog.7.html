<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>penlog &mdash; penlog  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="hr" href="hr.1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> penlog
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hr.1.html">hr</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">penlog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#specification">Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#json-format-json">JSON Format (json)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#json-pretty-json-pretty">JSON pretty (json-pretty)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#human-readable-format-hr">Human Readable Format (hr)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tiny-human-readable-format-hr-tiny">Tiny Human Readable Format (hr-tiny)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">penlog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>penlog</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/penlog.7.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="penlog">
<h1>penlog<a class="headerlink" href="#penlog" title="Permalink to this headline"></a></h1>
<section id="specification">
<h2>Specification<a class="headerlink" href="#specification" title="Permalink to this headline"></a></h2>
<p>The PENLog logging format is intended to be used as a generic and reusable data format for measurement data.
The penlog format specifies an abstract data format consisting of various fields with data and metadata.
The abstract penlog format can be mapped to multiple output formats, for instance <code class="docutils literal notranslate"><span class="pre">json</span></code>, or <code class="docutils literal notranslate"><span class="pre">hr</span></code>, …
All available output formats are explained below.</p>
<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all capitals, as shown here.</p>
<p>The penlog structured logging format consists of the following fields.
Unset fields which are considered optional MUST be absent.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">component</span></code> (string, OPTIONAL)</dt><dd><p>The component, e.g. software module, which has issued the log message.
In absence, an implementation SHOULD pull the content of the environment variable <code class="docutils literal notranslate"><span class="pre">PENLOG_COMPONENT</span></code> and MUST set it to <code class="docutils literal notranslate"><span class="pre">root</span></code> as a fallback.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code> (string, REQUIRED)</dt><dd><p>The log message as an UTF-8 string.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">host</span></code> (string, OPTIONAL)</dt><dd><p>The hostname of the machine who generated the messages.
This field is OPTIONAL, since it is missing in the human readable format.
It is RECOMMENDED that implementations include this field, as it increases reproducability of logging data.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code> (string, OPTIONAL)</dt><dd><p>A unique message identifier.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">line</span></code> (string, OPTIONAL)</dt><dd><p>Information about the file and line number where this log entry was generated.
The information MUST be in the form <code class="docutils literal notranslate"><span class="pre">filename:number</span></code>.
<code class="docutils literal notranslate"><span class="pre">filename</span></code> can be an absolute or relative path, or a filename.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priority</span></code> (int, OPTIONAL)</dt><dd><p>This field can be used to optionally set the priority.
For priorities, the syslog priorities are used as defined by RFC5424.
Implementations can indicate priorities by e.g. a separate color.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stacktrace</span></code> (string, OPTIONAL)</dt><dd><p>Implementations can optionally include a stacktrace.
This could be useful for debugging if fatal errors occur.
Stacktraces are very specific to the used programming language, e.g. python or go.
Thus, this field is just an unstructured string.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code> (list[string], OPTIONAL)</dt><dd><p>To each log entry a custom list of tags can be applied.
For instance: <code class="docutils literal notranslate"><span class="pre">[&quot;autogenerated&quot;,</span> <span class="pre">&quot;pre-test&quot;,</span> <span class="pre">&quot;post-test&quot;,</span> <span class="pre">…]</span></code>.
Tags MAY be key value pairs, separated by <code class="docutils literal notranslate"><span class="pre">=</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timestamp</span></code> (string, REQUIRED)</dt><dd><p>ISO8601 string of the current date.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code> (string, REQUIRED)</dt><dd><p>The type field is a free field which can be used to assign a particular message type.</p>
</dd>
</dl>
<p>Custom fields can be added freely, in other words, additional custom fields are OPTIONAL.
Their post-processing and tooling around these custom fields is up to the developer and MUST be ignored by generic converters.</p>
</section>
<section id="json-format-json">
<h2>JSON Format (json)<a class="headerlink" href="#json-format-json" title="Permalink to this headline"></a></h2>
<p>A penlog log file stored on disk is typically stored in the <code class="docutils literal notranslate"><span class="pre">json</span></code> output format.
The tool <code class="docutils literal notranslate"><span class="pre">hr(1)</span></code> is intended to be used – similar to <code class="docutils literal notranslate"><span class="pre">cat(1)</span></code> – for viewing penlog data in the <code class="docutils literal notranslate"><span class="pre">json</span></code> output format.
If encoding of a log message fails, the component MUST be set to <code class="docutils literal notranslate"><span class="pre">JSON</span></code>, the type to <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, and the error message MUST be included in <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">json</span></code> format consists of a verbatim sequence of the described JSON objects.
Each JSON object MUST be present at one line, separated by <code class="docutils literal notranslate"><span class="pre">\n</span></code> (ascii 0x0a).
In order to keep decoding simple and line based, no JSON arrays or virtual, endless JSON structures are employed.</p>
</section>
<section id="json-pretty-json-pretty">
<h2>JSON pretty (json-pretty)<a class="headerlink" href="#json-pretty-json-pretty" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">json</span></code> format forces every JSON object to appear in a single line.
The <code class="docutils literal notranslate"><span class="pre">json-pretty</span></code> format provides an indented, more readable json form for debugging purposes.
The actual content of <code class="docutils literal notranslate"><span class="pre">json</span></code> and <code class="docutils literal notranslate"><span class="pre">json-pretty</span></code> is the same.
It is adviced to use <code class="docutils literal notranslate"><span class="pre">json</span></code> for data processing pipelines due to less overhead.</p>
</section>
<section id="human-readable-format-hr">
<h2>Human Readable Format (hr)<a class="headerlink" href="#human-readable-format-hr" title="Permalink to this headline"></a></h2>
<p>The syntax of the human readable format looks like the following.
Curly braces indicate a field from the JSON format.
If a field is empty it expands to an zero length string; if <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">line</span></code>, <code class="docutils literal notranslate"><span class="pre">tags</span></code>, or <code class="docutils literal notranslate"><span class="pre">stacktrace</span></code> are not availabe, the whole line is omitted.
A verbatim curly brace brace is expressed with two ones: <code class="docutils literal notranslate"><span class="pre">{{</span></code> means <code class="docutils literal notranslate"><span class="pre">{</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">timestamp</span><span class="p">}</span> <span class="p">{{{</span><span class="n">component</span><span class="p">}}}</span> <span class="p">[{</span><span class="nb">type</span><span class="p">}]:</span> <span class="p">{</span><span class="n">prio</span><span class="o">-</span><span class="n">prefix</span><span class="p">}</span> <span class="p">{</span><span class="n">data</span><span class="p">}</span>
   <span class="o">-&gt;</span> <span class="nb">id</span>  <span class="p">:</span> <span class="p">{</span><span class="nb">id</span><span class="p">}</span>
   <span class="o">-&gt;</span> <span class="n">line</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">}</span>
   <span class="o">-&gt;</span> <span class="n">tags</span><span class="p">:</span> <span class="p">{</span><span class="n">tags</span><span class="p">}</span>
   <span class="o">-&gt;</span> <span class="n">stacktrace</span><span class="p">:</span>
   <span class="o">|</span> <span class="p">{</span><span class="n">stacktrace</span><span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></dt><dd><p>The RECOMMENDED timestamp format is Go’s <code class="docutils literal notranslate"><span class="pre">StampMilli</span></code> format as defined to <code class="docutils literal notranslate"><span class="pre">Jan</span> <span class="pre">_2</span> <span class="pre">15:04:05.000</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">component</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">component</span></code> and <code class="docutils literal notranslate"><span class="pre">type</span></code> fields MUST be padded or truncated that the colons, <code class="docutils literal notranslate"><span class="pre">:</span></code>, in every single line are perfectly aligned.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt><dd><p>The actual log message.
It MAY be truncated to fit in the current terminal size.
When it is truncated an ellipsis character (<code class="docutils literal notranslate"><span class="pre">…</span></code>) MUST be appended to indicate the truncation for the user,</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">id</span></code></dt><dd><p>The optional unique message identifier.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">line</span></code></dt><dd><p>The optional filename and line number where this log entry origins from.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stacktrace</span></code></dt><dd><p>The optional stacktrace where this log entry origins from.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prio-prefix</span></code></dt><dd><p>An optional priority prefix.
It is RECOMMENDED to indicate message priorities via colors.
If colors are not available it MAY be desireable to indicate the priority via a short prefix.
The prefixes are enclosed by brackets <code class="docutils literal notranslate"><span class="pre">[</span></code> and <code class="docutils literal notranslate"><span class="pre">]</span></code>: <code class="docutils literal notranslate"><span class="pre">E</span></code> <code class="docutils literal notranslate"><span class="pre">A</span></code>, <code class="docutils literal notranslate"><span class="pre">C</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code>, <code class="docutils literal notranslate"><span class="pre">w</span></code>, <code class="docutils literal notranslate"><span class="pre">n</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code>.
These letters stand for: emergency, alert, critical, error, warning, notice, info, debug.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code></dt><dd><p>The optional tags as comma separated values.</p>
</dd>
</dl>
</section>
<section id="tiny-human-readable-format-hr-tiny">
<h2>Tiny Human Readable Format (hr-tiny)<a class="headerlink" href="#tiny-human-readable-format-hr-tiny" title="Permalink to this headline"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">hr-tiny</span></code> format is the same as <code class="docutils literal notranslate"><span class="pre">hr</span></code> except that <code class="docutils literal notranslate"><span class="pre">component</span></code> and <code class="docutils literal notranslate"><span class="pre">type</span></code> are omitted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Apr</span>  <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mf">08.906</span><span class="p">:</span> <span class="n">Starting</span> <span class="n">tshark</span> <span class="k">with</span>
<span class="n">Apr</span>  <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mf">09.583</span><span class="p">:</span> <span class="n">Doing</span> <span class="n">stuff</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Apr</span>  <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mf">08.906</span> <span class="p">{</span><span class="n">scanner</span> <span class="p">}</span> <span class="p">[</span><span class="n">message</span><span class="p">]:</span> <span class="n">Starting</span> <span class="n">tshark</span> <span class="k">with</span>
<span class="n">Apr</span>  <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mf">09.583</span> <span class="p">{</span><span class="n">moncay</span>  <span class="p">}</span> <span class="p">[</span><span class="n">message</span><span class="p">]:</span> <span class="n">Doing</span> <span class="n">stuff</span>
</pre></div>
</div>
<p>If a JSON line cannot be decoded, the faulty text MUST be included in messages of type <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> and component <code class="docutils literal notranslate"><span class="pre">JSON</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -c &quot;import foo&quot; 2&gt;&amp;1 | hr
Jun 16 08:19:01.305 {JSON    } [ERROR   ]: Traceback (most recent call last):
Jun 16 08:19:01.305 {JSON    } [ERROR   ]:   File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
Jun 16 08:19:01.305 {JSON    } [ERROR   ]: ModuleNotFoundError: No module named &#39;foo&#39;
</pre></div>
</div>
</section>
<section id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline"></a></h2>
<p>The following environment variables MAY be understood by penlog implementations.
The supported datatypes are <code class="docutils literal notranslate"><span class="pre">string</span></code> and <code class="docutils literal notranslate"><span class="pre">bool</span></code>.
A <code class="docutils literal notranslate"><span class="pre">bool</span></code> is a special string consisting of either <code class="docutils literal notranslate"><span class="pre">t,</span> <span class="pre">T,</span> <span class="pre">true,</span> <span class="pre">TRUE,</span> <span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">f,</span> <span class="pre">F,</span> <span class="pre">false,</span> <span class="pre">FALSE,</span> <span class="pre">0</span></code>.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">PENLOG_COMPONENT</span></code> (string)</dt><dd><p>If no component is set, the <code class="docutils literal notranslate"><span class="pre">component</span></code> field MAY be set via the <code class="docutils literal notranslate"><span class="pre">PENLOG_COMPONENT</span></code> variable at the scope of an operating system process.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PENLOG_CAPTURE_LINES</span></code> (bool)</dt><dd><p>If this environment variable is set, implementations SHOULD emit filenames with line numbers via the <code class="docutils literal notranslate"><span class="pre">line</span></code> field.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PENLOG_CAPTURE_STACKTRACES</span></code> (bool)</dt><dd><p>If this environment variable is set, implementations SHOULD provide stacktraces via the <code class="docutils literal notranslate"><span class="pre">stacktrace</span></code> field.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PENLOG_OUTPUT</span></code> (string)</dt><dd><p>A switch for implementations to choose from several output forms.
Available are: <code class="docutils literal notranslate"><span class="pre">hr</span></code>, <code class="docutils literal notranslate"><span class="pre">hr-tiny</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code>, <code class="docutils literal notranslate"><span class="pre">json-pretty</span></code>, <code class="docutils literal notranslate"><span class="pre">systemd</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PENLOG_LOGLEVEL</span></code> (string)</dt><dd><p>In order to limit the emitted logging messages, loglevels MAY be supported.
If a library supports filtering based on loglevels, it MUST check this environment variable.
The supported values are <code class="docutils literal notranslate"><span class="pre">critical</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>, <code class="docutils literal notranslate"><span class="pre">warning</span></code>, <code class="docutils literal notranslate"><span class="pre">notice</span></code>, <code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">debug</span></code>, <code class="docutils literal notranslate"><span class="pre">trace</span></code>.
The default MUST be <code class="docutils literal notranslate"><span class="pre">info</span></code>.
A message MUST omitted if its <code class="docutils literal notranslate"><span class="pre">priority</span></code> field contains a value greater than <code class="docutils literal notranslate"><span class="pre">PENLOG_LOGLEVEL</span></code>.
A mapping between these strings and integer values is availabe in RFC5424.</p>
</dd>
</dl>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline"></a></h2>
<p>:manpage:<code class="docutils literal notranslate"><span class="pre">hr(1)</span></code></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hr.1.html" class="btn btn-neutral float-left" title="hr" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020 -- 2022, AISEC Pentest Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>